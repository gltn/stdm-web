{% load static %}
{% with data=data %}
    {% if data %}
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Submissions</h5>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                </div>
            </div>
            <div class="card-body">
                <table id="koboTable"
                       class="table table-bordered table-striped"
                       style="width:100%;
                              cursor:pointer;">
                    <thead>
                        <tr>
                            {% for col in columns %}<th id='{{ col|cut:" " }}'>{{ col }}</th>{% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for key,values in data.items %}
                            <tr>
                                {% for ky, val in values.items %}<td>{{ val|linebreaksbr }}</td>{% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% else %}
        <h4>Submissions</h4>
        <p>
            No submissions available!
        {% endif %}
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script>
        <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
        <script>
    var today = new Date().toISOString().slice(0, 10)
    var dataTableSet;
    var collapsedGroups = {};
    dataTableSet = $("#koboTable").DataTable({
      "scrollY": 400,
      "searching": true,
      hideEmptyCols: true,
      mark: true,
      scrollX: "100%",
      processing: true,
      "destroy": true,
      dom: 'Blfrtip',
      select: {
        style: 'single'
      },
      order: [[2, 'asc'],[0, 'desc']],
      buttons: [
        {
          extend: 'excelHtml5',
          text: '<i class="fa fa-file-excel-o"> Export to Excel</i>',
          titleAttr: 'Excel',
          title: 'Excel_Export_' + today,
          exportOptions: {
            columns: ':visible'
          },
        },
        {
          extend: 'csvHtml5',
          text: '<i class="fa fa-file-text-o"> Export to CSV</i>',
          titleAttr: 'CSV',
          title: 'CSV_Export_' + today,
          exportOptions: {
            columns: ':visible'
          },
        },
        {
          extend: 'pdfHtml5',
          text: '<i class="fa fa-file-pdf-o"> Export to PDF</i>',
          titleAttr: 'PDF',
          title: 'PDF_Export_' + today,
          orientation: 'landscape',
          pageSize: 'A0',
          //customize: function (doc) { 
            //doc.defaultStyle.fontSize = 4; //2,3,4,
            //doc.styles.tableHeader.fontSize = 4; //2, 3, 4, etc 
          //}
        }
      ],
     
    });
    
    $('#koboTable tbody').on('click', 'tr', function () {
      var data_row = dataTableSet.row(this).data();      
      var column = dataTableSet.column('DateOfProfiling:name').data();
      console.log('This is data row', column)
      var settlement = data_row[2]
      data_load = {
        'date_of_profiling': data_row[0],
        'city': data_row[1],
        'settlement': data_row[2],
        'ward': data_row[3],
        'type_of_settlement': data_row[4],
        'year_occupation': data_row[5],
        'reason_occupation': data_row[6],        
        'risk_level': data_row[7],
        'total_area': data_row[8],
        'renting_population': data_row[9],
        'structure_owners': data_row[10],
        'govt_owned': data_row[11],
        'most_de_es': data_row[12],
        'tenure_challenges': data_row[13],
        'household_number': data_row[14],
        'total_population': data_row[15],
        'males': data_row[16],
        'females': data_row[17],   
        'location': data_row[18],
        'major_problems': data_row[19],
        'development_projects':data_row[20],
        'priorities_identified':data_row[21],
        'services_in_settlement':data_row[22],
        'major_source_of_income': data_row[23],
        'income_levels_per_month':data_row[24],
        'saving_schemes_available':data_row[25],
        'expenditure_item_per_month':data_row[26],
        'common_health_facilities':data_row[27],
        'cases_of_covid19':data_row[28],
        'reported_cases':data_row[29],
      }
      $.ajax({
        url: '/mobile/kobo/submissions/visualization',
        data: { 'data': JSON.stringify(data_load) },
        traditional: true,
        success: function (json) {
          $('#subSummaries').css('display', 'block');
          $('#subSummaries').html(json);
          document.getElementById('subSummaries').scrollIntoView({
            behavior: 'smooth'
          });

        },

      })


    });
        </script>
        <!-- <script>
    $(document).ready(function () {
      $('#koboTable').on('shown.bs.collapse', function () {
        $($.fn.dataTable.tables(true)).DataTable().columns.adjust();
      });
    });
                                                                                                                                                          </script> -->
    {% endwith %}
