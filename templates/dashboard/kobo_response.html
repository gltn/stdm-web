{% load static %}
{% with data=data %} 
{% if data %}
<h4> Submissions</h4>
<table id="koboTable" class="table table-bordered table-striped" style="width: 100%;overflow: scroll;">
    <thead>
      <tr>
        {% for col in columns %}        
        <th>{{col}}</th>        
        {% endfor %}
      </tr>
    </thead>
    <tbody> 
    {% for key,values in data.items %} 
      <tr>
        
        {% for ky, val in values.items %}
        <td>{{val}}</td>
        {% endfor %}
         
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <h4> Submissions</h4>
  <p>No submissions available!
  {% endif %}
  
   <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
<script>
var today = new Date().toISOString().slice(0, 10)
var dataTableSet;
  dataTableSet = $("#koboTable").DataTable({
    "responsive": true,
    "autoWidth": true,
    "destroy": true,
    "scrollX": true,
    "searching": true,
    "sPaginationType":"full_numbers",
    dom: 'Blfrtip',
    select: {
                style: 'single'
            },      
        buttons: [
          {
            extend: 'excelHtml5',
            text: '<i class="fa fa-file-excel-o"> Export to Excel</i>',
            titleAttr: 'Excel',
            title: '_Excel_Export_'  + today,
            exportOptions: {
            columns: ':visible'
            },
          },
          {
            extend: 'csvHtml5',
            text: '<i class="fa fa-file-text-o"> Export to CSV</i>',
            titleAttr: 'CSV',
            title:  '_CSV_Export_'  + today,
            exportOptions: {
            columns: ':visible'
            },
          },
          {
            extend: 'pdfHtml5',
            text: '<i class="fa fa-file-pdf-o"> Export to PDF</i>',
            titleAttr: 'PDF',
            title: '_PDF_Export_' + today,
            orientation:'landscape',
            pageSize : 'LEGAL',
            exportOptions: {
            columns: ':visible'
            },
          }
        ],
});
 $('#koboTable tbody').on('click', 'tr', function () {
    var data_row = dataTableSet.row(this).data();
    var settlement = data_row[2]
    console.log(data_row)
    data_load = {
      'date_of_profiling': data_row[0],
      'city': data_row[1],
      'settlement': data_row[2],
      'ward': data_row[3],
      'type_of_settlement': data_row[4],
      'year_occupation': data_row[5],
      'reason_occupation':  data_row[6],
      'risk_level':  data_row[7],
      'total_area': data_row[8],
    }

    $.ajax({
        url: '/mobile/kobo/submissions/visualization',
        data:  { 'data' : JSON.stringify(data_load) },
        traditional: true, 
        success: function (json) {
          $('#subSummaries').css('display','block');
          $('#subSummaries').html(json);
          
        },

      })
    
    
} );
</script>
{% endwith %}

